{% extends "base.html" %}

{% block content %}
<h2>Project Tasks</h2>

<div id="task-list"></div>

<h3>Create Task</h3>
<input type="text" id="title" placeholder="Task title">
<button onclick="createTask()">Create</button>

<script>
const token = localStorage.getItem("access");
const projectId = "{{ project_id }}";

function loadTasks() {
    fetch(`/api/projects/${projectId}/tasks/`, {
        headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
        let html = "";
        data.forEach(task => {
            html += `
                <div class="card">
                    <strong>${task.title}</strong>
                    <p>${task.description || ""}</p>
                </div>
            `;
        });
        document.getElementById("task-list").innerHTML = html;
    });
}

function createTask() {
    fetch(`/api/projects/${projectId}/tasks/`, {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + token,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            title: document.getElementById("title").value
        })
    }).then(() => loadTasks());
}

loadTasks();
</script>

{% endblock %}